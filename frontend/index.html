<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Customers Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">
  <div class="container">
    <h1>Customers Dashboard</h1>

    <div class="card mb-3 p-3">
      <h5>Create / Update Customer</h5>
      <form id="customerForm">
        <input type="hidden" id="customer_id">
        <div class="row">
          <div class="col-md-4"><input id="first_name" class="form-control" placeholder="First name"></div>
          <div class="col-md-4"><input id="last_name" class="form-control" placeholder="Last name"></div>
          <div class="col-md-4"><input id="email" class="form-control" placeholder="Email"></div>
        </div>
        <div class="row mt-2">
          <div class="col-md-4"><input id="phone" class="form-control" placeholder="Phone"></div>
          <div class="col-md-4"><input id="document_number" class="form-control" placeholder="Document"></div>
          <div class="col-md-4">
            <button class="btn btn-primary" type="submit">Save</button>
            <button id="clearBtn" type="button" class="btn btn-secondary">Clear</button>
          </div>
        </div>
      </form>
    </div>

    <div>
      <h5>Customers</h5>
      <table class="table" id="customersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const apiBase = "http://localhost:3000/api/customers"; // tu endpoint

async function loadCustomers() {
  const tbody = document.querySelector('#customersTable tbody');
  try {
    const res = await fetch(apiBase);
    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

    const rows = await res.json();
    tbody.innerHTML = '';

    if (!Array.isArray(rows))  rows.length === 0;
      tbody.innerHTML = <tr><td colspan="5" style="text-align:center;">No hay clientes para mostrar</td></tr>;
      return;
    

    rows.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.customer_id}</td>
        <td>${r.first_name ?? ''} ${r.last_name ?? ''}</td>
        <td>${r.email }</td>
        <td>${r.phone || ''}</td>
        <td>
          <button class="btn btn-sm btn-info" onclick="editCustomer('${r.customer_id}')">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteCustomer('${r.customer_id}')">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    });

  } catch (error) {
    console.error("Error cargando clientes:", error);
    tbody.innerHTML = <tr><td colspan="5" style="color:red; text-align:center;">âš  Error al conectar con el servidor</td></tr>;
  }
}

    async function editCustomer(id) {
      const res = await fetch(apiBase + '/' + id);
      const c = await res.json();
      document.getElementById('customer_id').value = c.customer_id;
      document.getElementById('first_name').value = c.first_name;
      document.getElementById('last_name').value = c.last_name;
      document.getElementById('email').value = c.email || '';
      document.getElementById('phone').value = c.phone || '';
      document.getElementById('document_number').value = c.document_number || '';
    }

    async function deleteCustomer(id) {
      if (!confirm('Delete?')) return;
      await fetch(apiBase + '/' + id, { method: 'DELETE' });
      loadCustomers();
    }

    document.getElementById('customerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('customer_id').value;
      const data = {
        first_name: document.getElementById('first_name').value,
        last_name: document.getElementById('last_name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        document_number: document.getElementById('document_number').value
      };
      if (id) {
        await fetch(apiBase + '/' + id, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
      } else {
        await fetch(apiBase, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
      }
      document.getElementById('customerForm').reset();
      loadCustomers();
    });

    document.getElementById('clearBtn').addEventListener('click', () => document.getElementById('customerForm').reset());

loadCustomers();
  </script>
</body>

</html>